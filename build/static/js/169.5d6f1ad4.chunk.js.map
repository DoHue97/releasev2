{"version":3,"file":"static/js/169.5d6f1ad4.chunk.js","mappings":"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","sources":["wsclient/crmservices/httpBackOfficeUtil.js"],"sourcesContent":["/**\n * class to handle HTTP Requests and Token refresh\n */\n\nimport querystring from 'querystring';\nimport { initOptionHeader } from '../../utils/common';\n\nvar jwtDecode = require('jwt-decode');\n\nexport const httpBackOfficeUtil = {\n  setupChannel,\n  put,\n  post,\n  get,\n  sendDelete,\n  is200OK,\n  startSession,\n  getSession,\n  cleanObj,\n  cleanSession,\n  switchSession\n};\n\n\n/** local variables */\n\nlet _storeKVFn;\nlet _getKVFn;\nlet _sessionInvalidCallback;\nlet _fetchFn;\n\nlet _apiKey;\nlet _accessToken;\nlet _refreshToken;\nlet _host;\nlet _sessionData;\n\nlet _selfServicePath = 'self-service';\nlet _backofficePath = 'backoffice/v1/';\n/**\n * \n * TODO: do we need a call back for no internet connection ?\n * when no connection refresh token will not be available -> should not kick user out.\n */\n\nasync function setupChannel({\n  storeKVFn,  //function to store key value\n  getKVFn,    //function to get value by key from the storage\n  sessionInvalidCallback, //function to call when api_key or token key is invalid and refresh token if available was failed\n  apiKey,\n  host,\n  fetchFn\n}) {\n  _storeKVFn = storeKVFn;\n  _getKVFn = getKVFn;\n  _sessionInvalidCallback = sessionInvalidCallback;\n  _apiKey = apiKey;\n  _host = host;\n  if (fetchFn)\n    _fetchFn = fetchFn;\n  else\n    _fetchFn = fetch;\n\n  if (_getKVFn) {\n    _accessToken = await _getKVFn('access_token');\n    _refreshToken = await _getKVFn('refresh_token');\n    try {\n      if (_accessToken) \n        {\n          _sessionData = jwtDecode(_accessToken);\n          await refreshToken();\n        }\n    }catch (e) {\n      console.log('Failed to load session data: ', e);  \n      _sessionData = undefined;\n    }\n  }\n  //TODO add silent refresh token here\n}\n\nasync function refreshToken() {\n  try {\n    // console.log('Session data:', _sessionData);\n    // console.log('_refreshToken:', _refreshToken);\n    let currentTime = Date.now();\n    let tokenLiveInSec = (_sessionData.exp - currentTime/1000);\n    // console.log(\"tokenLiveInSec:\" + tokenLiveInSec);\n    if (tokenLiveInSec > 60*60)\n      return;\n\n  //try to refresh token\n\n    //console.log('API: ', contact)\n    let response = await post({\n        resourcePath: \"users/refresh\",\n        refreshToken: true,\n        logOutIfSessionInvalid: false,\n    });\n    if (response.code == \"OK\") {\n        startSession(response.data);\n        return;\n    }\n    \n  } catch (e) {\n      console.log(\"Exception refresh: \", e);\n      return;\n  }\n}\n\nfunction startSession({access_token,refresh_token, exp, organisations}) {\n  //TODO handle expiration\n  _accessToken = access_token;\n  _refreshToken = refresh_token;\n  if (_storeKVFn) {\n    _storeKVFn(\"refresh_token\", refresh_token)\n    _storeKVFn(\"access_token\", access_token)\n    //_storeKVFn(\"organisations\", JSON.stringify(organisations));\n    // _storeKVFn(\"exp\", exp)\n    //parse and store session data\n    _sessionData = jwtDecode(_accessToken);\n      // console.log('Session data:', _sessionData);\n  }\n\n}\n\n\n\nfunction switchSession({access_token,refresh_token, exp},isMerchant) {\n  _sessionData = jwtDecode(access_token);\n  if(isMerchant){\n    var _sessionServiceOwnerData = jwtDecode(_accessToken);\n    _storeKVFn(\"merchant_id\", _sessionData.current_organisation_id);\n    _storeKVFn(\"service_owner_id\", _sessionServiceOwnerData.current_organisation_id)\n  }else{\n    _storeKVFn(\"merchant_id\", null);\n  }\n\n  startSession({access_token,refresh_token, exp})\n}\n\nfunction cleanSession() {\n  //TODO handle expiration\n  _accessToken = undefined;\n  _refreshToken = undefined;\n  if (_storeKVFn) {\n    _storeKVFn(\"refresh_token\", undefined)\n    _storeKVFn(\"access_token\", undefined)\n    //parse and store session data\n      console.log('Session cleared');\n  }\n\n}\n\nfunction getSession() {\n  console.log(\"AAAAAAAAAAAAAAAAAAAA\");\n  console.log(\"AAAAAAAAAAAAAAAAAAAA\");\n  console.log(\"AAAAAAAAAAAAAAAAAAAA\");\n  console.log(\"AAAAAAAAAAAAAAAAAAAA _sessionData:\",_sessionData);\n  return _sessionData;\n}\n\nfunction getURI(isBackend, resourcePath) {\n  if (isBackend == true)\n    return _host + _backofficePath + resourcePath;\n  else\n    return _host + _selfServicePath + resourcePath;\n}\n\nfunction json2Obj(str) {\n  try {\n    return JSON.parse(str);\n  }catch (e){\n    return null;\n  }\n}\nasync function post({\n  resourcePath,\n  body,\n  queryParams,\n  withAccessToken = false,\n  withoutApikey = false,\n  logOutIfSessionInvalid=true,\n  refreshToken\n}) {\n  // let serverConfig = getServerConfig();\n  // let uri = getURI(isBackend, resourcePath);\n  let uri = _host + 'backoffice/v1/' + resourcePath;\n  var options = {};\n  options.headers = initOptionHeader();\n  options.method = \"POST\";\n  if (withAccessToken == true || logOutIfSessionInvalid==true || refreshToken==true) {\n    if (refreshToken)\n      options.headers['Authorization'] = 'Bearer ' + _refreshToken;\n    else\n      options.headers['Authorization'] = 'Bearer ' + _accessToken;\n  } else if(!withoutApikey)\n    options.headers['api_key'] = _apiKey;\n\n  // if (refreshToken) {\n  //   options.headers['refresh_token'] = refreshToken;\n  // }\n  if (body)\n    options.body = JSON.stringify(body);\n  if (queryParams)\n    uri = _host + '?' + querystring.encode(queryParams);\n  console.log('POST: ', uri, options);\n  let response = await _fetchFn(uri, options);\n  let bodyText = await response.text()\n  console.log('Response - ' ,response.status , ' - Body:', (bodyText ? json2Obj(bodyText) : bodyText));\n  if (response.status == '200') {\n    return { code: \"OK\", data: bodyText ? json2Obj(bodyText) : null };\n  } else\n  {\n    validateForceLogout(response,logOutIfSessionInvalid);\n    return { code: response.status, bodyText: bodyText, error: json2Obj(bodyText) };\n  }\n  \n    \n\n  //TODO: add token expire and validation later \n  // let accessToken;\n  // if (withAccessToken)\n  // {\n  //   //check if token is not expired\n  // }\n\n}\n\nasync function validateForceLogout(response,logOutIfSessionInvalid){\n  try {\n    if (logOutIfSessionInvalid == true && _sessionInvalidCallback && response.status == '401'){\n      await _sessionInvalidCallback();\n      cleanSession();\n    }      \n  }catch (e) {\n    console.log(e);\n  }\n}\n\nasync function get({\n  resourcePath,\n  queryParams,\n  withAccessToken = false,\n  isBackend = true,\n  logOutIfSessionInvalid = true,\n  returnText=false\n}) {\n  let uri = getURI(isBackend, resourcePath);\n  // let uri = _host + 'backoffice/v1/' + resourcePath;\n  var options = {};\n  options.headers = initOptionHeader();\n  options.method = \"GET\";\n  if (withAccessToken == true || logOutIfSessionInvalid==true)\n    options.headers['Authorization'] = 'Bearer ' + _accessToken;\n  else\n    options.headers['api_key'] = _apiKey;\n\n  if (queryParams)\n    uri = uri + '?' + querystring.encode(cleanObj(queryParams));\n  console.log('GET: ', uri, options);\n  let response = await _fetchFn(uri, options);\n  let bodyText = await response.text()\n  console.log('Response - ' ,response.status , ' - Body:', (bodyText ? json2Obj(bodyText) : bodyText));\n  if (response.status == '200') {\n    if(returnText)\n      return { code: \"OK\", data: bodyText};\n    return { code: \"OK\", data: bodyText ? json2Obj(bodyText) : null };\n  } else\n  {\n    validateForceLogout(response,logOutIfSessionInvalid);\n    return { code: response.status, bodyText: bodyText, error: json2Obj(bodyText) };\n  }\n\n  //TODO: add token expire and validation later \n  // let accessToken;\n  // if (withAccessToken)\n  // {\n  //   //check if token is not expired\n  // }\n\n}\n\nasync function sendDelete({\n  resourcePath,\n  queryParams,\n  withAccessToken = false,\n  isBackend = false,\n  logOutIfSessionInvalid = true\n}) {\n  // let uri = getURI(isBackend, resourcePath);\n  let uri = _host + 'backoffice/v1/' + resourcePath;\n  var options = {};\n  options.headers = initOptionHeader();\n  options.method = \"DELETE\";\n  if (withAccessToken == true || logOutIfSessionInvalid==true)\n    options.headers['Authorization'] = 'Bearer ' + _accessToken;\n  else\n    options.headers['api_key'] = _apiKey;\n\n  if (queryParams)\n    uri = uri + '?' + querystring.encode(cleanObj(queryParams));\n  console.log('GET: ', uri, options);\n  let response = await _fetchFn(uri, options);\n  let bodyText = await response.text()\n  console.log('Response - ' ,response.status , ' - Body:', (bodyText ? json2Obj(bodyText) : bodyText));\n  if (response.status == '200') {\n    return { code: \"OK\", data: bodyText ? json2Obj(bodyText) : null };\n  } else\n  {\n    validateForceLogout(response,logOutIfSessionInvalid);\n    return { code: response.status, bodyText: bodyText, error: json2Obj(bodyText) };\n  }\n\n  //TODO: add token expire and validation later \n  // let accessToken;\n  // if (withAccessToken)\n  // {\n  //   //check if token is not expired\n  // }\n\n}\n\nasync function put({\n  resourcePath,\n  body,\n  queryParams,\n  withAccessToken = false,\n  isBackend = false, \n  logOutIfSessionInvalid = true\n}) {\n  // let uri = getURI(isBackend, resourcePath);\n  let uri = _host + 'backoffice/v1/' + resourcePath;\n  var options = {};\n  options.headers = initOptionHeader();\n  options.method = \"PUT\";\n  if (withAccessToken == true || logOutIfSessionInvalid==true)\n    options.headers['Authorization'] = 'Bearer ' + _accessToken;\n  else\n    options.headers['api_key'] = _apiKey;\n\n  if (body)\n    options.body = JSON.stringify(body);\n  if (queryParams)\n    uri = uri + '?' + querystring.encode(queryParams);\n  console.log('PUT: ', uri, options);\n  let response = await _fetchFn(uri, options);\n  let bodyText = await response.text()\n  console.log('Response - ' ,response.status , ' - Body:', (bodyText ? json2Obj(bodyText) : bodyText));\n  if (response.status == '200') {\n    return { code: \"OK\", data: bodyText ? json2Obj(bodyText) : null };\n  }\n  else\n  {\n    validateForceLogout(response,logOutIfSessionInvalid);\n    return { code: response.status, bodyText: bodyText, error: json2Obj(bodyText) };\n  }\n\n  //TODO: add token expire and validation later \n  // let accessToken;\n  // if (withAccessToken)\n  // {\n  //   //check if token is not expired\n  // }\n\n}\n\nasync function getAccessToken() {\n\n}\n\nfunction is200OK(result) {\n  if (result && result.status && result.status == '200')\n    return true;\n  else\n    return false;\n}\n\nfunction cleanObj(obj) {\n  for (var propName in obj) { \n    if (obj[propName] === null || obj[propName] === undefined) {\n      delete obj[propName];\n    }\n  }\n  return obj;\n}\n"],"names":["_storeKVFn","_getKVFn","_sessionInvalidCallback","_fetchFn","_apiKey","_accessToken","_refreshToken","_host","_sessionData","jwtDecode","require","httpBackOfficeUtil","setupChannel","_x","_setupChannel","apply","arguments","put","_x7","_put","post","get","_x5","_get","sendDelete","_x6","_sendDelete","is200OK","result","status","startSession","getSession","console","log","cleanObj","cleanSession","switchSession","_ref3","isMerchant","access_token","refresh_token","exp","_sessionServiceOwnerData","current_organisation_id","_selfServicePath","_backofficePath","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_ref","storeKVFn","getKVFn","sessionInvalidCallback","apiKey","host","fetchFn","wrap","_context","prev","next","fetch","sent","refreshToken","t0","undefined","stop","_refreshToken2","_callee2","currentTime","response","_context2","Date","now","abrupt","resourcePath","logOutIfSessionInvalid","code","data","_ref2","organisations","getURI","isBackend","json2Obj","str","JSON","parse","e","_x2","_post","_callee3","_ref4","body","queryParams","_ref4$withAccessToken","withAccessToken","_ref4$withoutApikey","withoutApikey","_ref4$logOutIfSession","uri","options","bodyText","_context3","headers","initOptionHeader","method","stringify","querystring","text","validateForceLogout","error","_x3","_x4","_validateForceLogout","_callee4","_context4","_callee5","_ref5","_ref5$withAccessToken","_ref5$isBackend","_ref5$logOutIfSession","_ref5$returnText","returnText","_context5","_callee6","_ref6","_ref6$withAccessToken","_ref6$isBackend","_ref6$logOutIfSession","_context6","_callee7","_ref7","_ref7$withAccessToken","_ref7$isBackend","_ref7$logOutIfSession","_context7","obj","propName"],"sourceRoot":""}